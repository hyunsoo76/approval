{% extends "base.html" %}
{% load static %}

{% block title %}ë‚´ì‡¼ë‚ ìƒˆì²œë…„ ì „ìê²°ì¬{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  /* âœ… ë„ì¥ */
  .stamp-logo{
    height:50px;
    width:auto;
  }
  /* ì‹œìŠ¤í…œ í…ìŠ¤íŠ¸ ë¬¶ìŒ */
.system-wrap{
  display:inline-block;   /* í…ìŠ¤íŠ¸ í­ë§Œí¼ë§Œ */
  line-height:1.2;
  position:relative;
  padding-bottom:6px;
}

/* âœ… ë°‘ì¤„ì„ 'ë‚´ì‡¼ë‚ ìƒˆì²œë…„' í­ìœ¼ë¡œ */
.system-wrap::after{
  content:"";
  position:absolute;
  left:0;
  right:0;
  bottom:0;
  height:1.4px;
  background:#cfcfcf;
}

/* ì „ìê²°ì¬ */
.system-text{
  font-size:14px;
  color:#444;
  font-weight:700;
}

/* ===== ìƒíƒœ ë°°ì§€ ì»¤ìŠ¤í…€ ===== */
.badge-outline-success{
  background:#fff !important;
  color:#198754 !important;
  border:1px solid #198754 !important;
}

.badge-outline-danger{
  background:#fff !important;
  color:#dc3545 !important;
  border:1px solid #dc3545 !important;
}

</style>
{% endblock %}

{% block content %}
<div class="bg-light">
  <div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">

      <!-- ğŸ”´ ì™¼ìª½: ë„ì¥ + ì‹œìŠ¤í…œëª… -->
        <div class="d-flex align-items-center gap-3">

          <img src="{% static 'img/saecheon_stamp.png' %}"
              alt="ìƒˆì²œë…„ì¸"
              class="stamp-logo">

          <div class="system-wrap">
            <div style="font-size:20px; font-weight:800; letter-spacing:0.02em; color:#222;">
              ë‚´ì‡¼ë‚ ìƒˆì²œë…„
            </div>

            <div class="system-text" style="margin-top:2px;">
              ì „ìê²°ì¬
            </div>
          </div>

        </div>


      <!-- ğŸ”µ ì˜¤ë¥¸ìª½: ìƒˆ ê¸°ì•ˆ ë²„íŠ¼ -->
      <a class="btn btn-primary" href="/approval/v2/new/">+ ìƒˆ ê¸°ì•ˆ</a>
    </div>

    <form class="row g-2 mb-3" method="get" action="/approval/v2/">
      <div class="col-12 col-md-3">
        <select class="form-select" name="status">
          <option value="all" {% if status == "all" %}selected{% endif %}>ì „ì²´</option>
          <option value="in_progress" {% if status == "in_progress" %}selected{% endif %}>ì§„í–‰ì¤‘</option>
          <option value="completed" {% if status == "completed" %}selected{% endif %}>ì™„ë£Œ</option>
          <option value="rejected" {% if status == "rejected" %}selected{% endif %}>ë°˜ë ¤</option>
        </select>
      </div>
      <div class="col-12 col-md-7">
        <input class="form-control" name="q" value="{{ q }}" placeholder="ê²€ìƒ‰: ì œëª©/ë¶€ì„œ/ê¸°ì•ˆì">
      </div>
      <div class="col-12 col-md-2 d-grid">
        <button class="btn btn-outline-dark" type="submit">ê²€ìƒ‰</button>
      </div>
    </form>

    <!-- âœ… ëª¨ë°”ì¼ ì¹´ë“œ -->
    <div class="d-md-none">
      {% for row in approvals_ctx %}
        {% with a=row.a route=row.route %}
          <div class="card shadow-sm mb-2" onclick="location.href='/approval/v2/{{ a.id }}/'" style="cursor:pointer;">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <div class="small text-muted">#{{ a.id }}</div>
                  <div class="fw-semibold" style="line-height:1.25;">{{ a.title }}</div>
                </div>
                <div class="text-end">
                  {% if route and route.status == "in_progress" %}
                    <span class="badge text-bg-warning">ì§„í–‰ì¤‘</span>
                  {% elif route and route.status == "completed" %}
                    <span class="badge badge-outline-success">ì™„ë£Œ</span>
                  {% elif route and route.status == "rejected" %}
                    <span class="badge badge-outline-danger">ë°˜ë ¤</span>
                  {% else %}
                    <span class="badge text-bg-secondary">{% if route %}{{ route.status }}{% else %}-{% endif %}</span>
                  {% endif %}
                </div>
              </div>

              <div class="mt-2 small text-muted">{{ a.department }} Â· {{ a.name }}</div>
              <div class="small text-muted">ê¸°ì•ˆì¼: {{ a.created_at|date:"Y-m-d" }}</div>

              <div class="mt-1">
                <span class="badge text-bg-light border">í˜„ì¬ ë‹¨ê³„: {{ row.current_step_label }}</span>
              </div>
            </div>
          </div>
        {% endwith %}
      {% empty %}
        <div class="card shadow-sm">
          <div class="card-body text-center text-muted py-5">ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</div>
        </div>
      {% endfor %}
    </div>

    <!-- âœ… PC/íƒœë¸”ë¦¿ í‘œ -->
    <div class="card shadow-sm d-none d-md-block">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:90px;">ID</th>
              <th>ì œëª©</th>
              <th style="width:160px;">íšŒì›ì‚¬</th>
              <th style="width:120px;">ê¸°ì•ˆì</th>
              <th style="width:130px;">ê¸°ì•ˆì¼</th>
              <th style="width:140px;">ìƒíƒœ</th>
              <th style="width:140px;">í˜„ì¬ ë‹¨ê³„</th>
            </tr>
          </thead>
          <tbody>
            {% for row in approvals_ctx %}
              {% with a=row.a route=row.route %}
                <tr onclick="location.href='/approval/v2/{{ a.id }}/'" style="cursor:pointer;">
                  <td class="text-muted">#{{ a.id }}</td>
                  <td><strong>{{ a.title }}</strong></td>
                  <td>{{ a.department }}</td>
                  <td>{{ a.name }}</td>
                  <td>{{ a.created_at|date:"Y-m-d" }}</td>
                  <td>
                    {% if route and route.status == "in_progress" %}
                      <span class="badge text-bg-warning">ì§„í–‰ì¤‘</span>
                    {% elif route and route.status == "completed" %}
                      <span class="badge badge-outline-success">ì™„ë£Œ</span>
                    {% elif route and route.status == "rejected" %}
                      <span class="badge badge-outline-danger">ë°˜ë ¤</span>
                    {% else %}
                      <span class="badge text-bg-secondary">{% if route %}{{ route.status }}{% else %}-{% endif %}</span>
                    {% endif %}
                  </td>
                  <td>{{ row.current_step_label }}</td>
                </tr>
              {% endwith %}
            {% empty %}
              <tr><td colspan="7" class="text-center text-muted py-5">ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="text-muted mt-2" style="font-size:12px;">
      ìµœëŒ€ 200ê±´ í‘œì‹œ(ì¶”í›„ í˜ì´ì§€ë„¤ì´ì…˜ ì¶”ê°€)
    </div>
  </div>
</div>
{% endblock %}
