{% extends "base.html" %}
{% load static %}

{% block title %}내쇼날새천년 전자결재{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  /* ✅ 도장 */
  .stamp-logo{
    height:50px;
    width:auto;
  }

  /* 시스템 텍스트 묶음 */
  .system-wrap{
    display:inline-block;
    line-height:1.2;
    position:relative;
    padding-bottom:6px;
  }

  .system-wrap::after{
    content:"";
    position:absolute;
    left:0;
    right:0;
    bottom:0;
    height:1.4px;
    background:#cfcfcf;
  }

  .system-text{
    font-size:14px;
    color:#444;
    font-weight:700;
  }

  /* ===== 현재 단계 배지 ===== */
  .step-badge{
    display:inline-block;
    padding:6px 10px;
    border-radius:8px;
    font-size:13px;
    font-weight:700;
    line-height:1;
    white-space:nowrap;
  }

  /* 완료 */
  .step-complete{
    background:#fff;
    color:#198754;
    border:1px solid #198754;
  }

  /* 반려 */
  .step-reject{
    background:#fff;
    color:#0d6efd;
    border:1px solid #0d6efd;
  }

  /* ✅ 부드러운 노랑 대기 */
  .step-wait{
    background:#fff3cd;
    color:#664d03;
    border:1px solid #ffecb5;
  }

  /* ✅ 테이블 밀도감 조정 */
  .table td, .table th{
    vertical-align: middle;
    padding-top:0.6rem;
    padding-bottom:0.6rem;
  }

  /* ✅ row hover 효과 */
  .table tbody tr:hover{
    background:#f8f9fa;
    transition:0.15s ease;
  }

  /* 모바일 카드 그림자 살짝 줄임 */
  .card{
    box-shadow:0 1px 3px rgba(0,0,0,0.05) !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="bg-light">
  <div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">

      <div class="d-flex align-items-center gap-3">
        <img src="{% static 'img/saecheon_stamp.png' %}"
            alt="새천년인"
            class="stamp-logo">

        <div class="system-wrap">
          <div style="font-size:20px; font-weight:800; letter-spacing:0.02em; color:#222;">
            내쇼날새천년
          </div>

          <div class="system-text" style="margin-top:2px;">
            전자결재
          </div>
        </div>
      </div>

      <a class="btn btn-outline-dark fw-semibold" href="/approval/v2/new/">
        + 새 기안
      </a>
    </div>

    <form class="row g-2 mb-3" method="get" action="/approval/v2/">
      <div class="col-12 col-md-3">
        <select class="form-select" name="status">
          <option value="all" {% if status == "all" %}selected{% endif %}>전체</option>
          <option value="in_progress" {% if status == "in_progress" %}selected{% endif %}>진행중</option>
          <option value="completed" {% if status == "completed" %}selected{% endif %}>완료</option>
          <option value="rejected" {% if status == "rejected" %}selected{% endif %}>반려</option>
        </select>
      </div>
      <div class="col-12 col-md-7">
        <input class="form-control" name="q" value="{{ q }}" placeholder="검색: 제목/부서/기안자">
      </div>
      <div class="col-12 col-md-2 d-grid">
        <button class="btn btn-outline-dark" type="submit">검색</button>
      </div>
    </form>

    <!-- 모바일 -->
    <div class="d-md-none">
      {% for row in approvals_ctx %}
        {% with a=row.a route=row.route %}
          <div class="card mb-2" onclick="location.href='/approval/v2/{{ a.id }}/'" style="cursor:pointer;">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div class="me-2">
                  <div class="small text-muted">#{{ a.id }}</div>
                  <div class="fw-semibold" style="line-height:1.25;">{{ a.title }}</div>
                </div>

                <div class="text-end">
                  {% if route and route.status == "completed" %}
                    <span class="step-badge step-complete">완료</span>
                  {% elif route and route.status == "rejected" %}
                    <span class="step-badge step-reject">반려</span>
                  {% else %}
                    <span class="step-badge step-wait">{{ row.current_step_label }}</span>
                  {% endif %}
                </div>
              </div>

              <div class="mt-2 small text-muted">{{ a.department }} · {{ a.name }}</div>
              <div class="small text-muted">기안일: {{ a.created_at|date:"Y-m-d" }}</div>
            </div>
          </div>
        {% endwith %}
      {% empty %}
        <div class="card">
          <div class="card-body text-center text-muted py-5">문서가 없습니다</div>
        </div>
      {% endfor %}
    </div>

    <!-- PC -->
    <div class="card d-none d-md-block">
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th style="width:90px;">ID</th>
              <th>제목</th>
              <th style="width:160px;">회원사</th>
              <th style="width:120px;">기안자</th>
              <th style="width:130px;">기안일</th>
              <th style="width:180px;">현재 단계</th>
            </tr>
          </thead>
          <tbody>
            {% for row in approvals_ctx %}
              {% with a=row.a route=row.route %}
                <tr onclick="location.href='/approval/v2/{{ a.id }}/'" style="cursor:pointer;">
                  <td class="text-muted">#{{ a.id }}</td>
                  <td><strong>{{ a.title }}</strong></td>
                  <td>{{ a.department }}</td>
                  <td>{{ a.name }}</td>
                  <td>{{ a.created_at|date:"Y-m-d" }}</td>
                  <td>
                    {% if route and route.status == "completed" %}
                      <span class="step-badge step-complete">완료</span>
                    {% elif route and route.status == "rejected" %}
                      <span class="step-badge step-reject">반려</span>
                    {% else %}
                      <span class="step-badge step-wait">{{ row.current_step_label }}</span>
                    {% endif %}
                  </td>
                </tr>
              {% endwith %}
            {% empty %}
              <tr><td colspan="6" class="text-center text-muted py-5">문서가 없습니다</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="text-muted mt-2" style="font-size:12px;">
      최대 200건 표시(추후 페이지네이션 추가)
    </div>
  </div>
</div>
{% endblock %}